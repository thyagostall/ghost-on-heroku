function Pong(){"use strict";function i(){o=new Image,o.onload=function(){l=!0},o.src=w,n.image=new Image,n.image.onload=function(){n.imageReady=!0,n.width=n.image.width,n.height=n.image.height,n.x=n.width,n.y=(r-n.height)/2},n.image.src=n.imageSrc,d.image=new Image,d.image.onload=function(){d.imageReady=!0,d.width=d.image.width,d.height=d.image.height,d.x=m-2*d.width,d.y=(r-n.height)/2},d.image.src=d.imageSrc,g.image=new Image,g.image.onload=function(){g.imageReady=!0,g.side=g.image.width},g.image.src=g.imageSrc,g.serve(1)}function t(){g.update(),n.update(),d.update()}function e(){a.font="32px Cambria",a.fillStyle="#ff6",l&&a.drawImage(o,0,0),a.save(),g.draw(),n.draw(),d.draw(),a.restore()}var h,a,s,n,d,g,o,m=800,r=600,y=Math.PI,c=38,u=40,l=!1,w="pong/img/background.png",f=!1;n={x:null,y:null,width:20,height:100,score:0,imageReady:!1,imageSrc:"pong/img/paddle.png",image:null,update:function(){s[c]&&(this.y-=14),s[u]&&(this.y+=14),this.y=Math.max(Math.min(this.y,r-this.height),0)},draw:function(){this.imageReady&&a.drawImage(this.image,this.x,this.y),a.fillText(this.score,m/2-60,38)}},d={x:null,y:null,width:20,height:100,score:0,imageReady:!1,imageSrc:"pong/img/paddle.png",image:null,update:function(){if(g.isInCourt()){var i=g.y-.5*(this.height+g.side);this.y+=.1*(i-this.y),this.y=Math.max(Math.min(this.y,r-this.height),0)}else{var t=(r-this.height)/2,e=10;this.y>t+e?this.y-=7:this.y<t-e&&(this.y+=7)}},draw:function(){this.imageReady&&a.drawImage(this.image,this.x,this.y);var i=this.score;a.fillText(i,m/2+60-a.measureText(i).width,38)}},g={x:null,y:null,side:20,speed:12,velocity:null,imageReady:!1,imageSrc:"pong/img/ball.png",image:null,serve:function(i){var t=Math.random();this.x=1===i?n.x+n.width:d.x-this.side,this.y=(r-this.side)*t;var e=.1*y*(1-2*t);this.velocity={x:i*this.speed*Math.cos(e),y:this.speed*Math.sin(e)}},update:function(){if(this.x+=this.velocity.x,this.y+=this.velocity.y,this.y<0||this.y+this.side>r){var i=this.velocity.y<0?0-this.y:r-(this.y+this.side);this.y+=2*i,this.velocity.y*=-1}var t=function(i,t,e,h,a,s,n,d){var g=a+n>i&&s+d>t&&i+e>a&&t+h>s;return g},e=this.velocity.x<0?n:d;if(t(e.x,e.y,e.width,e.height,this.x,this.y,this.side,this.side)){this.x=e===n?n.x+n.width:d.x-this.side;var h=(this.y+this.side-e.y)/(e.height+this.side),a=y/4*(2*h-1),s=Math.abs(a)>.2*y?1.5:1;this.velocity.x=s*(e===n?1:-1)*this.speed*Math.cos(a),this.velocity.y=s*this.speed*Math.sin(a)}if(this.x+this.side<0||this.x>m){var g=this;f||(f=!0,setTimeout(function(){var i=null;i=e===n?d:n,g.serve(e===n?1:-1),i.score+=1,f=!1},2e3))}},draw:function(){this.imageReady&&a.drawImage(this.image,this.x,this.y)},isInCourt:function(){return this.x>=0&&this.x<=m&&this.y>=0&&this.y<=r}},this.startGame=function(o,y){h=document.getElementById(o),h.width=m,h.height=r,a=h.getContext("2d"),s={},document.addEventListener("keydown",function(i){s[i.keyCode]=!0}),document.addEventListener("keyup",function(i){delete s[i.keyCode]}),window.addEventListener("keydown",function(i){[32,37,38,39,40].indexOf(i.keyCode)>-1&&i.preventDefault()},!1),i(),w=y+w,n.imageSrc=y+n.imageSrc,d.imageSrc=y+d.imageSrc,g.imageSrc=y+g.imageSrc;var c=function(){t(),e(),window.requestAnimationFrame(c,h)};window.requestAnimationFrame(c,h)}}